{% load crispy_forms_tags %}
<div id="comment-form" class="comment-form">
  <form method="POST" action="{% url 'comment-post' object.id %}" class="ml-45">
    {% csrf_token %}
    {{ comment_form|crispy }}
    <div>
      <button class="btn btn-primary btn-sm" type="submit">发布</button>
    </div>
  </form>
</div>
{% block script_extends %}
  <script type="text/javascript">
    $("#comment_form").submit(function(event){
      event.preventDefault();
      console.log("form submitted!")  // sanity check
      //submit asynchronously

        $.ajax({
        url : "{% url 'post-detail' object.id  %}", // the endpoint
        type : "POST", // http method
        data : $(this).serialize() // data sent with the post request

        // handle a successful response
        success : function(json) {
            $('#comment-form').val(''); // remove the value from the input

            $("#comment-container").prepend("<li><strong>"+json.content+"</strong> - <em> "+json.user+"</em> - <span> "+json.created+"</span></li>");
            console.log("success"); // another sanity check
        },

        // handle a non-successful response
        error : function(xhr,errmsg,err) {
            $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
      })
      return false

  </script>
{% endblock %}
